â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ğŸŒ CLIENT LAYER                                 â”‚
â”‚                     (Browser/Mobile/API)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ HTTP Requests
                  â”‚ POST /auth/login (public)
                  â”‚ GET /auth/me (protected)
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ğŸšª SPRING CLOUD GATEWAY (Port 8080)                     â”‚
â”‚                        Entry Point + Router                            â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              ğŸ§  JwtAuthenticationGatewayFilterFactory             â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ“‹ PUBLIC      â”‚    â”‚  ğŸ” PROTECTED   â”‚    â”‚  ğŸš« SECURITY  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  /auth/login    â”‚    â”‚  /auth/me       â”‚    â”‚  Missing JWT  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  NO AUTH âœ…     â”‚    â”‚  JWT REQUIRED   â”‚    â”‚  â†’ 401 âŒ     â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âš¡ Rate Limiting â”‚  â”‚ ğŸ”‘ IP Resolver  â”‚  â”‚  ğŸ”’ HTTPS Redirect      â”‚ â”‚
â”‚  â”‚ Redis-based     â”‚  â”‚ Request trackingâ”‚  â”‚  HTTP â†’ HTTPS           â”‚ â”‚
â”‚  â”‚ authRateLimiter â”‚  â”‚ ipKeyResolver   â”‚  â”‚  SecurityConfig         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“Š Management Port: 8082 (Actuator)                                   â”‚
â”‚  ğŸ¯ ROUTING RULES:                                                      â”‚
â”‚      /auth/** â†’ http://localhost:8081                                  â”‚
â”‚      /actuator/health â†’ http://localhost:8080                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                               â”‚
                       â”‚ HTTP Routing ONLY             â”‚ Redis Connection
                       â”‚ (No Database Connection)      â”‚ (Rate Limiting)
                       â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ğŸ” AUTH-SERVICE (Port 8081)                           â”‚
â”‚                    Authentication Microservice                         â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ® AuthControllerâ”‚  â”‚ ğŸ”‘ JWT Utils    â”‚  â”‚ ğŸ›¡ï¸ Security Config      â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                         â”‚ â”‚
â”‚  â”‚ POST /login     â”‚  â”‚ Token generationâ”‚  â”‚ FilterChainProxy        â”‚ â”‚
â”‚  â”‚ GET /me         â”‚  â”‚ Token validationâ”‚  â”‚ Anonymous allowed       â”‚ â”‚
â”‚  â”‚ POST /register  â”‚  â”‚ HMAC-SHA256     â”‚  â”‚ for public endpoints    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ‘¥ UserService  â”‚  â”‚ ğŸ—ƒï¸ DatabaseInit â”‚  â”‚ ğŸ“Š Repository Layer     â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                         â”‚ â”‚
â”‚  â”‚ User operations â”‚  â”‚ Schema creation â”‚  â”‚ JPA/Hibernate           â”‚ â”‚
â”‚  â”‚ Password hash   â”‚  â”‚ Data seeding    â”‚  â”‚ UserRepository          â”‚ â”‚
â”‚  â”‚ Role management â”‚  â”‚ admin/user/test â”‚  â”‚ RoleRepository          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                               â”‚
                       â”‚ JPA/Hibernate                 â”‚ Redis Connection
                       â”‚ Connection Pool (HikariCP)    â”‚ (Cache/Session)
                       â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ğŸ’¾ DATABASE LAYER                                 â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        ğŸ˜ POSTGRESQL            â”‚   â”‚         ğŸ”´ REDIS            â”‚  â”‚
â”‚  â”‚                                 â”‚   â”‚                             â”‚  â”‚
â”‚  â”‚  â¬…ï¸ SOLO AUTH-SERVICE          â”‚   â”‚  â¬…ï¸ GATEWAY + AUTH-SERVICE  â”‚  â”‚
â”‚  â”‚     (JPA Connection)            â”‚   â”‚     (Rate Limiting + Cache) â”‚  â”‚
â”‚  â”‚                                 â”‚   â”‚                             â”‚  â”‚
â”‚  â”‚  ğŸ“¦ DUAL CONTAINER SETUP:       â”‚   â”‚  ğŸ“¦ DUAL CONTAINER SETUP:   â”‚  â”‚
â”‚  â”‚  â”œâ”€ postgres-staging:5432       â”‚   â”‚  â”œâ”€ redis-staging:6379      â”‚  â”‚
â”‚  â”‚  â””â”€ spring-mono-postgres:15432  â”‚   â”‚  â””â”€ spring-mono-redis:16379 â”‚  â”‚
â”‚  â”‚                                 â”‚   â”‚                             â”‚  â”‚
â”‚  â”‚  ğŸ“‹ DATABASE SCHEMA:            â”‚   â”‚  âš¡ CACHE & RATE LIMITING:  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ”§ TABLES:             â”‚    â”‚   â”‚  â”‚  ğŸ”§ KEYS:               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ users (id, username, â”‚    â”‚   â”‚  â”‚  â”œâ”€ rate_limit:*       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   email, password,   â”‚    â”‚   â”‚  â”‚  â”œâ”€ auth_session:*     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   created_date)      â”‚    â”‚   â”‚  â”‚  â””â”€ jwt_blacklist:*    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ user_roles          â”‚    â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ authorities         â”‚    â”‚   â”‚                             â”‚  â”‚
â”‚  â”‚  â”‚                         â”‚    â”‚   â”‚  âš¡ FUNCTIONS:               â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ‘¥ SEEDED USERS:       â”‚    â”‚   â”‚  â”œâ”€ Request rate limiting   â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ admin/admin123      â”‚    â”‚   â”‚  â”œâ”€ IP-based tracking      â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ user/user123        â”‚    â”‚   â”‚  â””â”€ Token blacklisting     â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ test/test123        â”‚    â”‚   â”‚                             â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š ACTUAL REQUEST FLOW (VERIFIED):
=================================

ğŸ”“ PUBLIC ENDPOINT FLOW:
â”Œâ”€ Client: POST /auth/login
â”œâ”€ Gateway: "PUBLIC ACCESS: /auth/login - No authentication required"
â”œâ”€ Gateway: Route to localhost:8081/auth/login (HTTP only)
â”œâ”€ Auth-Service: AnonymousAuthenticationFilter (allowed)
â”œâ”€ Auth-Service: Generate JWT token
â””â”€ Response: 200 + JWT token

ğŸ” PROTECTED ENDPOINT FLOW (WITH TOKEN):
â”Œâ”€ Client: GET /auth/me + Bearer JWT
â”œâ”€ Gateway: "PROTECTED ACCESS: /auth/me - JWT validation required"
â”œâ”€ Gateway: "AUTH SUCCESS: User 'admin' with roles 'ADMIN'"
â”œâ”€ Gateway: Route to localhost:8081/auth/me (HTTP only)
â”œâ”€ Auth-Service: FilterChainProxy secures request
â””â”€ Response: 200 + user data

ğŸš« PROTECTED ENDPOINT FLOW (WITHOUT TOKEN):
â”Œâ”€ Client: GET /auth/me (no token)
â”œâ”€ Gateway: "PROTECTED ACCESS: /auth/me - JWT validation required"
â”œâ”€ Gateway: "AUTH FAILURE: Missing JWT token"
â””â”€ Response: 401 Unauthorized

ğŸ¯ CORRECTED CONNECTION ARCHITECTURE:
====================================
CLIENT â†’ GATEWAY â†’ AUTH-SERVICE â†’ POSTGRESQL
         â†“         â†“
       REDIS     REDIS
    (rate limit) (cache/session)

âœ… Gateway connects ONLY to Redis (rate limiting)
âœ… Auth-Service connects to both PostgreSQL (data) and Redis (cache)

ğŸŒŸ ARCHITECTURAL PATTERNS IDENTIFIED:
====================================
âœ… API Gateway Pattern (Spring Cloud Gateway)
âœ… JWT Stateless Authentication
âœ… Smart Security Filter (public/protected detection)
âœ… Redis-based Rate Limiting
âœ… Multi-environment Configuration (dev/staging/prod/secure)
âœ… Dual Database Setup (resilience)
âœ… CSRF Protection (disabled for APIs)
âœ… HTTPS Redirect (configurable)
âœ… Circuit Breaker Ready (Resilience4j)
âœ… Observability (Actuator endpoints)

ğŸ¯ TECHNOLOGY STACK:
===================
â€¢ Spring Boot 3.4.5
â€¢ Spring Cloud Gateway
â€¢ Spring Security 6.4.5
â€¢ JWT (jsonwebtoken 0.11.5)
â€¢ PostgreSQL (dual instances)
â€¢ Redis (rate limiting & caching)
â€¢ Docker Compose (infrastructure)
â€¢ Maven (multi-module build)


