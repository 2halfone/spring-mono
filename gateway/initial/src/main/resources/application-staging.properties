# Gateway Service - Staging Environment Configuration
spring.application.name=gateway-service

# HTTP Configuration for Staging (SSL disabled for testing)
server.port=8080
server.ssl.enabled=false
server.address=0.0.0.0

# Management endpoints on different port (8082 to avoid conflict with auth-service on 8081)
management.server.port=8082
management.server.ssl.enabled=false

# JWT Configuration
jwt.secret=${JWT_SECRET:mySecretKey123456789012345678901234567890}
jwt.issuer=${JWT_ISSUER:spring-microservices}

# Management endpoints
management.endpoints.web.exposure.include=health,info,metrics

# Redis Configuration for Rate Limiting
spring.redis.host=localhost
spring.redis.port=6379
spring.redis.password=
spring.redis.timeout=2000ms

# Logging Configuration for Staging
logging.level.root=INFO
logging.level.com.example.gateway=DEBUG
logging.level.com.example.security=DEBUG

# ===== SECURITY GATEWAY CONFIGURATION =====
# Global Default Filters applied to ALL routes
spring.cloud.gateway.default-filters[0]=JwtAuthentication

# Route to auth-service: Fixed URI to localhost:8081 for staging
spring.cloud.gateway.routes[0].id=auth
spring.cloud.gateway.routes[0].predicates[0]=Path=/auth/**
spring.cloud.gateway.routes[0].uri=http://localhost:8081
# Apply JWT filter to auth routes (will skip public endpoints internally)
spring.cloud.gateway.routes[0].filters[0]=JwtAuthentication

# Route to chat-service: Commented out since chat-service is not implemented yet
# spring.cloud.gateway.routes[1].id=chat
# spring.cloud.gateway.routes[1].predicates[0]=Path=/chat/**
# spring.cloud.gateway.routes[1].uri=http://localhost:8082
# spring.cloud.gateway.routes[1].filters[0]=JwtAuthentication

# Route for any other service (future-proof) - Commented out for staging
# spring.cloud.gateway.routes[2].id=api
# spring.cloud.gateway.routes[2].predicates[0]=Path=/api/**
# spring.cloud.gateway.routes[2].uri=lb://api-service
# spring.cloud.gateway.routes[2].filters[0]=JwtAuthentication

# Health check route (public, no JWT required)
spring.cloud.gateway.routes[1].id=health
spring.cloud.gateway.routes[1].predicates[0]=Path=/actuator/health
spring.cloud.gateway.routes[1].uri=http://localhost:8080

# CORS configuration for staging
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedOrigins=http://localhost:3000,http://localhost:8080
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedMethods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedHeaders=*
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowCredentials=true
