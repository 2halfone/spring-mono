# 🔐 SECURE GATEWAY CONFIGURATION
# Gateway Service - Secure Profile for Internal Service Communication

spring.application.name=gateway-service

# 🌐 HTTP Configuration for Secure Environment
server.port=8080
server.ssl.enabled=false
server.address=0.0.0.0

# 📊 Management endpoints on main port (internal network is secure)
management.endpoints.web.exposure.include=health,info,metrics,gateway
management.endpoint.health.show-details=always

# 🔑 JWT Configuration
jwt.secret=${JWT_SECRET:mySecretKey123456789012345678901234567890}
jwt.issuer=${JWT_ISSUER:spring-microservices}

# 🚀 Redis Configuration for Rate Limiting (Internal)
spring.redis.host=${REDIS_HOST:redis}
spring.redis.port=${REDIS_PORT:6379}
spring.redis.password=${REDIS_PASSWORD:}
spring.redis.timeout=2000ms

# 📝 Logging Configuration for Secure Environment  
logging.level.root=INFO
logging.level.com.example.gateway=DEBUG
logging.level.com.example.security=DEBUG
logging.level.org.springframework.cloud.gateway=DEBUG

# ===== 🔐 SECURE GATEWAY ROUTING CONFIGURATION =====
# All routes use INTERNAL service URLs (no external ports)

# 🔐 AUTH SERVICE ROUTE - Internal Communication (Simplified)
spring.cloud.gateway.routes[0].id=auth-service
spring.cloud.gateway.routes[0].uri=http://auth-service:8080
spring.cloud.gateway.routes[0].predicates[0]=Path=/auth/**
# Removed JWT auth for auth endpoints (login/register need to be public)
spring.cloud.gateway.routes[0].filters[0]=name=RequestRateLimiter
spring.cloud.gateway.routes[0].filters[0].args.redis-rate-limiter.replenish-rate=10
spring.cloud.gateway.routes[0].filters[0].args.redis-rate-limiter.burst-capacity=20

# 🌐 API SERVICE ROUTE - Future expansion (Simplified)
spring.cloud.gateway.routes[1].id=api-service
spring.cloud.gateway.routes[1].uri=http://api-service:8080
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/**
spring.cloud.gateway.routes[1].filters[0]=name=RequestRateLimiter
spring.cloud.gateway.routes[1].filters[0].args.redis-rate-limiter.replenish-rate=5
spring.cloud.gateway.routes[1].filters[0].args.redis-rate-limiter.burst-capacity=10

# 📊 ACTUATOR ROUTES - Management endpoints
spring.cloud.gateway.routes[2].id=management
spring.cloud.gateway.routes[2].uri=http://localhost:8080
spring.cloud.gateway.routes[2].predicates[0]=Path=/actuator/**
# No JWT filter for health checks

# ===== 🔒 SECURITY CONFIGURATION =====

# 🌍 CORS Configuration (Simplified for testing)
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedOriginPatterns=*
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedMethods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedHeaders=*
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowCredentials=true
spring.cloud.gateway.globalcors.corsConfigurations.[/**].maxAge=3600

# 📏 Request Size Limits  
spring.cloud.gateway.httpclient.max-header-size=16KB
spring.cloud.gateway.httpclient.max-initial-line-length=4KB

# ⏱️ Timeout Configuration
spring.cloud.gateway.httpclient.connect-timeout=5000
spring.cloud.gateway.httpclient.response-timeout=30000

# 🔄 Retry Configuration
spring.cloud.gateway.default-filters[2]=name=Retry
spring.cloud.gateway.default-filters[2].args.retries=3
spring.cloud.gateway.default-filters[2].args.methods=GET,POST
spring.cloud.gateway.default-filters[2].args.backoff.firstBackoff=100ms
spring.cloud.gateway.default-filters[2].args.backoff.maxBackoff=500ms
